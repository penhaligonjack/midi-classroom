<!DOCTYPE html>
<html>
<head>
  <title>MIDI Student</title>
</head>
<body>
<h2>MIDI Classroom – STUDENT</h2>

<label>Room name:</label>
<input id="room" value="room1">
<button id="connectBtn">Connect</button>

<p id="status">Not connected</p>

<button id="sendNote">Send test MIDI note</button>

<script>
let ws = null;

// ---- WebSocket URL selection ----
function selectWebSocketUrl() {
  if (location.hostname === "localhost") {
    return "ws://localhost:8080";
  }
  return "wss://midi-classroom-production.up.railway.app";
}

function setStatus(t) {
  document.getElementById("status").innerText = t;
}

document.getElementById("connectBtn").addEventListener("click", () => {
  const room = document.getElementById("room").value || "room1";
  const wsUrl = selectWebSocketUrl();

  setStatus("Connecting to " + wsUrl + "...");

  ws = new WebSocket(wsUrl);

  ws.onopen = () => {
    setStatus("Connected");
    ws.send(JSON.stringify({ type: "join", role: "student", room }));
  };

  ws.onmessage = (ev) => {
    console.log("Message from host:", ev.data);
  };

  ws.onclose = () => setStatus("Disconnected");
  ws.onerror = () => setStatus("WebSocket error — check Railway logs");
});

document.getElementById("sendNote").addEventListener("click", () => {
  if (!ws || ws.readyState !== WebSocket.OPEN) {
    alert("Not connected!");
    return;
  }

  ws.send(JSON.stringify({
    type: "midi",
    data: { note: 60, velocity: 100, type: "noteon" }
  }));
});
</script>
</body>
</html>
