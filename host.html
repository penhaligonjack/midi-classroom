<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Host – MIDI Classroom</title>
</head>
<body>
    <h1>Host – MIDI Classroom</h1>

    <label>Select Classroom:</label>
    <select id="classroom">
        <option value="77">Classroom 77</option>
        <option value="78">Classroom 78</option>
    </select>
    <br><br>

    <button id="connectBtn">Start Hosting</button>
    <p id="status">Not connected</p>

    <h2>Incoming Student Notes</h2>
    <pre id="log" style="background:#eee;padding:10px;"></pre>

    <script>
        let ws;

        const log = (msg) => {
            document.getElementById("log").textContent += msg + "\n";
        };

        document.getElementById("connectBtn").onclick = () => {
            const classroom = document.getElementById("classroom").value;

            ws = new WebSocket(`wss://${window.location.host}`);

            ws.onopen = () => {
                document.getElementById("status").innerText = "Connected";

                ws.send(JSON.stringify({
                    type: "host-join",
                    classroom
                }));
            };

            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);

                if (data.type === "midi") {
                    log(
                        `Keyboard ${data.keyboard} → Note ${data.note}  (Velocity ${data.velocity})`
                    );
                }
            };

            ws.onclose = () => {
                document.getElementById("status").innerText = "Disconnected";
            };

            ws.onerror = (e) => {
                document.getElementById("status").innerText = "WebSocket error";
                console.error(e);
            };
        };
    </script>
</body>
</html>
